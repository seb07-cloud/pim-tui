---
phase: 01-native-rest-migration
plan: 03
type: execute
wave: 2
depends_on: ["01-01", "01-02"]
files_modified:
  - internal/azure/client.go
  - internal/azure/lighthouse.go
  - internal/azure/pim.go
  - internal/azure/groups.go
autonomous: true

must_haves:
  truths:
    - "Application builds without errors"
    - "All existing functionality works identically"
    - "No exec, runtime imports remain in azure package (if not needed elsewhere)"
  artifacts:
    - path: "internal/azure/client.go"
      provides: "Clean SDK-only client"
    - path: "internal/azure/lighthouse.go"
      provides: "Clean ARM requests"
  key_links:
    - from: "GetRoles"
      to: "pimRequest"
      via: "PIM API call"
    - from: "GetLighthouseSubscriptions"
      to: "armRequest"
      via: "ARM API call"
---

<objective>
Clean up unused imports and verify end-to-end functionality.

Purpose: Remove dead code artifacts and confirm the migration is complete.
Output: Clean codebase with no az CLI artifacts, verified to build successfully.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@internal/azure/client.go
@internal/azure/lighthouse.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clean up unused imports in client.go</name>
  <files>internal/azure/client.go</files>
  <action>
    1. Remove "os/exec" import (no longer needed without az CLI)
    2. Remove "runtime" import (no longer needed without Windows path detection)
    3. Remove "strings" import if no longer used (check for remaining usage)
    4. Keep all other imports that are still used

    Run `goimports` or manually verify each import is used.
  </action>
  <verify>go build ./... compiles without "imported and not used" errors</verify>
  <done>client.go has no unused imports</done>
</task>

<task type="auto">
  <name>Task 2: Final verification of all azure package files</name>
  <files>internal/azure/client.go, internal/azure/lighthouse.go, internal/azure/pim.go, internal/azure/groups.go</files>
  <action>
    1. Run `go build ./...` to verify compilation
    2. Run `go vet ./...` to check for common issues
    3. Verify no references to:
       - exec.Command
       - azCommand
       - azRestRequest
       - useAzRest
       - runtime.GOOS (for az path detection)
    4. Confirm all files in internal/azure/ compile cleanly

    If any issues found, fix them.
  </action>
  <verify>go build ./... && go vet ./... both pass</verify>
  <done>All azure package files build and pass vet</done>
</task>

<task type="auto">
  <name>Task 3: Document the migration in code comment</name>
  <files>internal/azure/client.go</files>
  <action>
    Update the package-level comment or NewClient function comment to reflect:
    - Client uses azidentity.AzureCLICredential for authentication
    - Requires user to have run `az login` before using the application
    - No subprocess execution; all API calls are direct HTTP with SDK tokens

    Keep comment concise (2-3 lines).
  </action>
  <verify>grep -A3 "NewClient" internal/azure/client.go shows updated documentation</verify>
  <done>Code comments updated to reflect SDK-only authentication</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./...` succeeds
- [ ] `go vet ./...` passes with no issues
- [ ] `grep -r "exec.Command\|azCommand\|useAzRest\|azRestRequest" internal/azure/` returns no matches
- [ ] No "imported and not used" errors
- [ ] NewClient comment updated
</verification>

<success_criteria>
- All tasks completed
- Codebase is clean with no dead code or unused imports
- Build and vet pass
- Documentation reflects new architecture
</success_criteria>

<output>
After completion, create `.planning/phases/01-native-rest-migration/01-03-SUMMARY.md`
</output>
